!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Sqrl={})}(this,(function(e){"use strict";function t(e){var n,r,a=new Error(e);return n=a,r=t.prototype,Object.setPrototypeOf?Object.setPrototypeOf(n,r):n.__proto__=r,a}function n(e,n,r){var a=n.slice(0,r).split(/\n/),i=a.length,s=a[i-1].length+1;throw t(e+=" at line "+i+" col "+s+":\n\n  "+n.split(/\n/)[i-1]+"\n  "+Array(s).join(" ")+"^")}t.prototype=Object.create(Error.prototype,{name:{value:"Squirrelly Error",enumerable:!1}});var r=new Function("return this")().Promise,a=!1;try{a=new Function("return (async function(){}).constructor")()}catch(e){if(!(e instanceof SyntaxError))throw e}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e,t,n){for(var r in t)i(t,r)&&(null==t[r]||"object"!=typeof t[r]||"storage"!==r||n?e[r]=t[r]:e[r]=s({},t[r]));return e}var o=/^async +/,c=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,l=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,f=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function u(e,r){c.lastIndex=0,l.lastIndex=0,f.lastIndex=0;var a=new RegExp("([|()]|=>)|'|\"|`|\\/\\*|\\s*((\\/)?(-|_)?"+r.tags[1]+")","g"),i=new RegExp("([^]*?)"+r.tags[0]+"(-|_)?\\s*","g"),s=0,u=!1;function p(t){var p,h={f:[]},d=0,g=e[s],v="c",m="r";function y(t){var a=e.slice(s,t),i=a.trim();if("f"===v)"safe"===i?h.raw=!0:r.async&&o.test(i)?(i=i.replace(o,""),h.f.push([i,"",!0])):h.f.push([i,""]);else if("fp"===v)h.f[h.f.length-1][1]+=i;else if("err"===v){if(i){var c=a.search(/\S/);n("invalid syntax",e,s+c)}}else h[v]=i;s=t+1}for(s+=1,"@"===g||"#"===g||"/"===g?(v="n",m=g):"!"===g||"?"===g?m=g:"*"===g?h.raw=!0:s-=1,a.lastIndex=s;null!==(p=a.exec(e));){var x=p[1],w=p[2],b=p[3],F=p[4],S=p.index;if(x)"("===x?(0===d&&("n"===v?(y(S),v="p"):"f"===v&&(y(S),v="fp")),d++):")"===x?0===--d&&"c"!==v&&(y(S),v="err"):0===d&&"|"===x?(y(S),v="f"):"=>"===x&&(y(S),s+=1,v="res");else{if(w)return y(S),s=S+p[0].length,i.lastIndex=s,u=F,b&&"@"===m&&(m="s"),h.t=m,h;var I=p[0];if("/*"===I){var R=e.indexOf("*/",a.lastIndex);-1===R&&n("unclosed comment",e,p.index),a.lastIndex=R}else if("'"===I){l.lastIndex=p.index,l.exec(e)?a.lastIndex=l.lastIndex:n("unclosed string",e,p.index)}else if('"'===I){f.lastIndex=p.index,f.exec(e)?a.lastIndex=f.lastIndex:n("unclosed string",e,p.index)}else if("`"===I){c.lastIndex=p.index,c.exec(e)?a.lastIndex=c.lastIndex:n("unclosed string",e,p.index)}}}return n("unclosed tag",e,t),h}var h=function a(c,l){c.b=[],c.d=[];var f,h=!1,d=[];function g(e,t){e&&(e=function(e,t,n,r){var a,i;return"string"==typeof t.autoTrim?a=i=t.autoTrim:Array.isArray(t.autoTrim)&&(a=t.autoTrim[1],i=t.autoTrim[0]),(n||!1===n)&&(a=n),(r||!1===r)&&(i=r),"slurp"===a&&"slurp"===i?e.trim():("_"===a||"slurp"===a?e=String.prototype.trimLeft?e.trimLeft():e.replace(/^[\s\uFEFF\xA0]+/,""):"-"!==a&&"nl"!==a||(e=e.replace(/^(?:\n|\r|\r\n)/,"")),"_"===i||"slurp"===i?e=String.prototype.trimRight?e.trimRight():e.replace(/[\s\uFEFF\xA0]+$/,""):"-"!==i&&"nl"!==i||(e=e.replace(/(?:\n|\r|\r\n)$/,"")),e)}(e,r,u,t))&&(e=e.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),d.push(e))}for(;null!==(f=i.exec(e));){g(f[1],f[2]),s=f.index+f[0].length;var v=p(f.index),m=v.t;if("@"===m){var y=v.n||"";r.async&&o.test(y)&&(v.a=!0,v.n=y.replace(o,"")),v=a(v),d.push(v)}else if("/"===m){if(c.n===v.n)return h?(h.d=d,c.b.push(h)):c.d=d,c;n("Helper start and end don't match",e,f.index+f[0].length)}else if("#"===m){h?(h.d=d,c.b.push(h)):c.d=d;var x=v.n||"";r.async&&o.test(x)&&(v.a=!0,v.n=x.replace(o,"")),h=v,d=[]}else if("s"===m){var w=v.n||"";r.async&&o.test(w)&&(v.a=!0,v.n=w.replace(o,"")),d.push(v)}else d.push(v)}if(!l)throw t('unclosed helper "'+c.n+'"');return g(e.slice(s,e.length),!1),c.d=d,c}({f:[]},!0);if(r.plugins)for(var d=0;d<r.plugins.length;d++){var g=r.plugins[d];g.processAST&&(h.d=g.processAST(h.d,r))}return h.d}function p(e,t){var n=u(e,t),r="var tR='';"+(t.useWith?"with("+t.varName+"||{}){":"")+m(n,t)+"if(cb){cb(null,tR)} return tR"+(t.useWith?"}":"");if(t.plugins)for(var a=0;a<t.plugins.length;a++){var i=t.plugins[a];i.processFnString&&(r=i.processFnString(r,t))}return r}function h(e,t,n){for(var r=0;r<t.length;r++){var a=t[r][0],i=t[r][1];e=(t[r][2]?"await ":"")+"c.l('F','"+a+"')("+e,i&&(e+=","+i),e+=")"}return e}function d(e,t,n,r,a,i){var s="{exec:"+(a?"async ":"")+v(n,t,e)+",params:["+r+"]";return i&&(s+=",name:'"+i+"'"),a&&(s+=",async:true"),s+="}"}function g(e,t){for(var n="[",r=0;r<e.length;r++){var a=e[r];n+=d(t,a.res||"",a.d,a.p||"",a.a,a.n),r<e.length&&(n+=",")}return n+="]"}function v(e,t,n){return"function("+t+"){var tR='';"+m(e,n)+"return tR}"}function m(e,t){for(var n=0,r=e.length,a="";n<r;n++){var i=e[n];if("string"==typeof i){a+="tR+='"+i+"';"}else{var s=i.t,o=i.c||"",c=i.f,l=i.n||"",f=i.p||"",u=i.res||"",p=i.b,v=!!i.a;if("r"===s)t.defaultFilter&&(o="c.l('F','"+t.defaultFilter+"')("+o+")"),!i.raw&&t.autoEscape&&(o="c.l('F','e')("+o+")"),a+="tR+="+h(o,c)+";";else if("@"===s)if(t.storage.nativeHelpers.get(l))a+=t.storage.nativeHelpers.get(l)(i,t);else{var m=(v?"await ":"")+"c.l('H','"+l+"')("+d(t,u,i.d,f,v);m+=p?","+g(p,t):",[]",a+="tR+="+h(m+=",c)",c)+";"}else"s"===s?a+="tR+="+h((v?"await ":"")+"c.l('H','"+l+"')({params:["+f+"]},[],c)",c)+";":"!"===s&&(a+=o+"\n")}}return a}var y=function(){function e(e){this.cache=e}return e.prototype.define=function(e,t){this.cache[e]=t},e.prototype.get=function(e){return this.cache[e]},e.prototype.remove=function(e){delete this.cache[e]},e.prototype.reset=function(){this.cache={}},e.prototype.load=function(e){s(this.cache,e,!0)},e}(),x=new y({});function w(e,n,r,a){if(n&&n.length>0)throw t((a?"Native":"")+"Helper '"+e+"' doesn't accept blocks");if(r&&r.length>0)throw t((a?"Native":"")+"Helper '"+e+"' doesn't accept filters")}var b=new y({each:function(e,t){var n="",r=e.params[0];if(w("each",t,!1),e.async)return new Promise((function(t){!function e(t,n,r,a,i){r(t[n],n).then((function(s){a+=s,n===t.length-1?i(a):e(t,n+1,r,a,i)}))}(r,0,e.exec,n,t)}));for(var a=0;a<r.length;a++)n+=e.exec(r[a],a);return n},foreach:function(e,t){var n=e.params[0];if(w("foreach",t,!1),e.async)return new Promise((function(t){!function e(t,n,r,a,i,s){a(n[r],t[n[r]]).then((function(o){i+=o,r===n.length-1?s(i):e(t,n,r+1,a,i,s)}))}(n,Object.keys(n),0,e.exec,"",t)}));var r="";for(var a in n)i(n,a)&&(r+=e.exec(a,n[a]));return r},include:function(e,n,r){w("include",n,!1);var a=r.storage.templates.get(e.params[0]);if(!a)throw t('Could not fetch template "'+e.params[0]+'"');return a(e.params[1],r)},extends:function(e,n,r){var a=e.params[1]||{};a.content=e.exec();for(var i=0;i<n.length;i++){var s=n[i];a[s.name]=s.exec()}var o=r.storage.templates.get(e.params[0]);if(!o)throw t('Could not fetch template "'+e.params[0]+'"');return o(a,r)},useScope:function(e,t){return w("useScope",t,!1),e.exec(e.params[0])}}),F=new y({if:function(e,t){w("if",!1,e.f,!0);var n="if("+e.p+"){"+m(e.d,t)+"}";if(e.b)for(var r=0;r<e.b.length;r++){var a=e.b[r];"else"===a.n?n+="else{"+m(a.d,t)+"}":"elif"===a.n&&(n+="else if("+a.p+"){"+m(a.d,t)+"}")}return n},try:function(e,n){if(w("try",!1,e.f,!0),!e.b||1!==e.b.length||"catch"!==e.b[0].n)throw t("native helper 'try' only accepts 1 block, 'catch'");var r="try{"+m(e.d,n)+"}",a=e.b[0];return r+="catch"+(a.res?"("+a.res+")":"")+"{"+m(a.d,n)+"}"},block:function(e,t){return w("block",e.b,e.f,!0),"if(!"+t.varName+"["+e.p+"]){tR+=("+v(e.d,"",t)+")()}else{tR+="+t.varName+"["+e.p+"]}"}}),S={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#39;"};function I(e){return S[e]}var R=new y({e:function(e){var t=String(e);return/[&<"']/.test(t)?t.replace(/[&<"']/g,I):t}}),E={varName:"it",autoTrim:[!1,"nl"],autoEscape:!0,defaultFilter:!1,tags:["{{","}}"],l:function(e,n){if("H"===e){var r=this.storage.helpers.get(n);if(r)return r;throw t("Can't find helper '"+n+"'")}if("F"===e){var a=this.storage.filters.get(n);if(a)return a;throw t("Can't find filter '"+n+"'")}},async:!1,storage:{helpers:b,nativeHelpers:F,filters:R,templates:x},cache:!1,plugins:[],useWith:!1};function j(e,t){var n={};return s(n,E),t&&s(n,t),e&&s(n,e),n.l.bind(n),n}function H(e,n){var r=j(n||{}),i=Function;if(r.async){if(!a)throw t("This environment doesn't support async/await");i=a}try{return new i(r.varName,"c","cb",p(e,r))}catch(n){throw n instanceof SyntaxError?t("Bad template syntax\n\n"+n.message+"\n"+Array(n.message.length+1).join("=")+"\n"+p(e,r)):n}}function O(e,t){var n;return t.cache&&t.name&&t.storage.templates.get(t.name)?t.storage.templates.get(t.name):(n="function"==typeof e?e:H(e,t),t.cache&&t.name&&t.storage.templates.define(t.name,n),n)}E.l.bind(E),e.compile=H,e.compileScope=m,e.compileScopeIntoFunction=v,e.compileToString=p,e.defaultConfig=E,e.filters=R,e.getConfig=j,e.helpers=b,e.nativeHelpers=F,e.parse=u,e.render=function(e,n,a,i){var s=j(a||{});if(!s.async)return O(e,s)(n,s);if(!i){if("function"==typeof r)return new r((function(t,r){try{t(O(e,s)(n,s))}catch(e){r(e)}}));throw t("Please provide a callback function, this env doesn't support Promises")}try{O(e,s)(n,s,i)}catch(e){return i(e)}},e.templates=x,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=squirrelly.min.js.map
