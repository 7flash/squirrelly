!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Sqrl={})}(this,(function(e){"use strict";function t(e){var r,n,a=new Error(e);return r=a,n=t.prototype,Object.setPrototypeOf?Object.setPrototypeOf(r,n):r.__proto__=n,a}function r(e,r,n){var a=r.slice(0,n).split(/\n/),i=a.length,o=a[i-1].length+1;throw t(e+=" at line "+i+" col "+o+":\n\n  "+r.split(/\n/)[i-1]+"\n  "+Array(o).join(" ")+"^")}t.prototype=Object.create(Error.prototype,{name:{value:"Squirrelly Error",enumerable:!1}});var n=new Function("return this")().Promise,a=!1;try{a=new Function("return (async function(){}).constructor")()}catch(e){if(!(e instanceof SyntaxError))throw e}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function o(e,t,r){for(var n in t)i(t,n)&&(null==t[n]||"object"!=typeof t[n]||"storage"!==n||r?e[n]=t[n]:e[n]=o({},t[n]));return e}var c=/^async +/;function s(e,n){var a=new RegExp("([|()]|=>)|'(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r'\\\\])*?'|`(?:\\\\[\\s\\w\"'\\\\`]|[^\\\\`])*?`|\"(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r\"\\\\])*?\"|\\/\\*[^]*?\\*\\/|((\\/)?(-|_)?"+n.tags[1]+")","g"),i=new RegExp("([^]*?)"+n.tags[0]+"(-|_)?\\s*","g"),o=0,s="";function f(){var t,f={f:[]},l=0,u=e[o],p="c",h="r";function g(t){var a=e.slice(o,t),i=a.trim();if("f"===p)"safe"===i?f.raw=!0:n.async&&c.test(i)?(i=i.replace(c,""),f.f.push([i,"",!0])):f.f.push([i,""]);else if("fp"===p)f.f[f.f.length-1][1]+=i;else if("err"===p){if(i){var s=a.search(/\S/);r("invalid syntax",e,o+s)}}else f[p]=i;o=t+1}for(o+=1,"~"===u||"#"===u||"/"===u?(p="n",h=u):"!"===u||"?"===u?h=u:"*"===u?f.raw=!0:o-=1,a.lastIndex=o;null!==(t=a.exec(e));){var v=t[1],m=t[2],d=t[3],y=t[4],w=t.index;if(v)"("===v?(0===l&&("n"===p?(g(w),p="p"):"f"===p&&(g(w),p="fp")),l++):")"===v?0===--l&&"c"!==p&&(g(w),p="err"):0===l&&"|"===v?(g(w),p="f"):"=>"===v&&(g(w),o+=1,p="res");else if(m)return g(w),o=w+t[0].length,i.lastIndex=o,s=y,d&&"~"===h&&(h="s"),f.t=h,f}return r("unclosed tag",e,e.length),f}var l=function a(l,u){l.b=[],l.d=[];var p,h=!1,g=[];function v(e,t){if(e){var r=e.replace(/\\/g,"\\\\").replace(/'/g,"\\'");(r=function(e,t,r,n){var a,i;return"string"==typeof t.autoTrim?a=i=t.autoTrim:Array.isArray(t.autoTrim)&&(a=t.autoTrim[1],i=t.autoTrim[0]),r&&(a=r),n&&(i=n),"slurp"===a&&"slurp"===i?e.trim():("_"===a||"slurp"===a?e=String.prototype.trimLeft?e.trimLeft():e.replace(/^[\s\uFEFF\xA0]+/,""):"-"!==a&&"nl"!==a||(e=e.replace(/^(?:\n|\r|\r\n)/,"")),"_"===i||"slurp"===i?e=String.prototype.trimRight?e.trimRight():e.replace(/[\s\uFEFF\xA0]+$/,""):"-"!==i&&"nl"!==i||(e=e.replace(/(?:\n|\r|\r\n)$/,"")),e)}(r,n,s,t))&&g.push(r)}}for(;null!==(p=i.exec(e));){v(p[1],p[2]),o=p.index+p[0].length;var m=f(),d=m.t;if("~"===d){var y=m.n||"";n.async&&c.test(y)&&(m.a=!0,m.n=y.replace(c,"")),m=a(m),g.push(m)}else if("/"===d){if(l.n===m.n)return h?(h.d=g,l.b.push(h)):l.d=g,l;r("Helper start and end don't match",e,p.index+p[0].length)}else if("#"===d){h?(h.d=g,l.b.push(h)):l.d=g;var w=m.n||"";n.async&&c.test(w)&&(m.a=!0,m.n=w.replace(c,"")),h=m,g=[]}else if("s"===d){var b=m.n||"";n.async&&c.test(b)&&(m.a=!0,m.n=b.replace(c,"")),g.push(m)}else g.push(m)}if(!u)throw t('unclosed helper "'+l.n+'"');return v(e.slice(o,e.length)),l.d=g,l}({f:[]},!0);if(n.plugins)for(var u=0;u<n.plugins.length;u++){var p=n.plugins[u];p.processAST&&(l.d=p.processAST(l.d,n))}return l.d}function f(e,t){var r=s(e,t),n="var tR='';"+(t.useWith?"with("+t.varName+"||{}){":"")+g(r,t).replace(/\n/g,"\\n").replace(/\r/g,"\\r")+"if(cb){cb(null,tR)} return tR"+(t.useWith?"}":"");if(t.plugins)for(var a=0;a<t.plugins.length;a++){var i=t.plugins[a];i.processFnString&&(n=i.processFnString(n,t))}return n}function l(e,t,r){for(var n=0;n<t.length;n++){var a=t[n][0],i=t[n][1];e=(t[n][2]?"await ":"")+"c.l('F','"+a+"')("+e,i&&(e+=","+i),e+=")"}return e}function u(e,t,r,n,a,i){var o="{exec:"+(a?"async ":"")+h(r,t,e)+",params:["+n+"]";return i&&(o+=",name:'"+i+"'"),a&&(o+=",async:true"),o+="}"}function p(e,t){for(var r="[",n=0;n<e.length;n++){var a=e[n];r+=u(t,a.res||"",a.d,a.p||"",a.a,a.n),n<e.length&&(r+=",")}return r+="]"}function h(e,t,r){return"function("+t+"){var tR='';"+g(e,r)+"return tR}"}function g(e,t){for(var r=0,n=e.length,a="";r<n;r++){var i=e[r];if("string"==typeof i){a+="tR+='"+i+"';"}else{var o=i.t,c=i.c||"",s=i.f,f=i.n||"",h=i.p||"",g=i.res||"",v=i.b,m=!!i.a;if("r"===o)t.defaultFilter&&(c="c.l('F','"+t.defaultFilter+"')("+c+")"),!i.raw&&t.autoEscape&&(c="c.l('F','e')("+c+")"),a+="tR+="+l(c,s)+";";else if("~"===o)if(t.storage.nativeHelpers.get(f))a+=t.storage.nativeHelpers.get(f)(i,t);else{var d=(m?"await ":"")+"c.l('H','"+f+"')("+u(t,g,i.d,h,m);d+=v?","+p(v,t):",[]",a+="tR+="+l(d+=",c)",s)+";"}else"s"===o?a+="tR+="+l((m?"await ":"")+"c.l('H','"+f+"')({params:["+h+"]},[],c)",s)+";":"!"===o&&(a+=c)}}return a}var v=function(){function e(e){this.cache=e}return e.prototype.define=function(e,t){this.cache[e]=t},e.prototype.get=function(e){return this.cache[e]},e.prototype.remove=function(e){delete this.cache[e]},e.prototype.reset=function(){this.cache={}},e.prototype.load=function(e){o(this.cache,e,!0)},e}(),m=new v({});function d(e,r,n,a){if(r&&r.length>0)throw t((a?"Native":"")+"Helper '"+e+"' doesn't accept blocks");if(n&&n.length>0)throw t((a?"Native":"")+"Helper '"+e+"' doesn't accept filters")}var y=new v({each:function(e,t){var r="",n=e.params[0];if(d("each",t,!1),e.async)return new Promise((function(t){!function e(t,r,n,a,i){n(t[r],r).then((function(o){a+=o,r===t.length-1?i(a):e(t,r+1,n,a,i)}))}(n,0,e.exec,r,t)}));for(var a=0;a<n.length;a++)r+=e.exec(n[a],a);return r},foreach:function(e,t){var r=e.params[0];if(d("foreach",t,!1),e.async)return new Promise((function(t){!function e(t,r,n,a,i,o){a(r[n],t[r[n]]).then((function(c){i+=c,n===r.length-1?o(i):e(t,r,n+1,a,i,o)}))}(r,Object.keys(r),0,e.exec,"",t)}));var n="";for(var a in r)i(r,a)&&(n+=e.exec(a,r[a]));return n},include:function(e,r,n){d("include",r,!1);var a=n.storage.templates.get(e.params[0]);if(!a)throw t('Could not fetch template "'+e.params[0]+'"');return a(e.params[1],n)},extends:function(e,r,n){var a=e.params[1]||{};a.content=e.exec();for(var i=0;i<r.length;i++){var o=r[i];a[o.name]=o.exec()}var c=n.storage.templates.get(e.params[0]);if(!c)throw t('Could not fetch template "'+e.params[0]+'"');return c(a,n)},useScope:function(e,t){return d("useScope",t,!1),e.exec(e.params[0])}}),w=new v({if:function(e,t){d("if",!1,e.f,!0);var r="if("+e.p+"){"+g(e.d,t)+"}";if(e.b)for(var n=0;n<e.b.length;n++){var a=e.b[n];"else"===a.n?r+="else{"+g(a.d,t)+"}":"elif"===a.n&&(r+="else if("+a.p+"){"+g(a.d,t)+"}")}return r},try:function(e,r){if(d("try",!1,e.f,!0),!e.b||1!==e.b.length||"catch"!==e.b[0].n)throw t("native helper 'try' only accepts 1 block, 'catch'");var n="try{"+g(e.d,r)+"}",a=e.b[0];return n+="catch"+(a.res?"("+a.res+")":"")+"{"+g(a.d,r)+"}"},block:function(e,t){return d("block",e.b,e.f,!0),"if(!"+t.varName+"["+e.p+"]){tR+=("+h(e.d,"",t)+")()}else{tR+="+t.varName+"["+e.p+"]}"}}),b={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#39;"};function x(e){return b[e]}var F=new v({e:function(e){var t=String(e);return/[&<"']/.test(t)?t.replace(/[&<"']/g,x):t}}),S={varName:"it",autoTrim:[!1,"nl"],autoEscape:!0,defaultFilter:!1,tags:["{{","}}"],l:function(e,r){if("H"===e){var n=this.storage.helpers.get(r);if(n)return n;throw t("Can't find helper '"+r+"'")}if("F"===e){var a=this.storage.filters.get(r);if(a)return a;throw t("Can't find filter '"+r+"'")}},async:!1,storage:{helpers:y,nativeHelpers:w,filters:F,templates:m},cache:!1,plugins:[],useWith:!1};function R(e,t){var r={};return o(r,S),t&&o(r,t),e&&o(r,e),r.l.bind(r),r}function E(e,r){var n=R(r||{}),i=Function;if(n.async){if(!a)throw t("This environment doesn't support async/await");i=a}try{return new i(n.varName,"c","cb",f(e,n))}catch(r){throw r instanceof SyntaxError?t("Bad template syntax\n\n"+r.message+"\n"+Array(r.message.length+1).join("=")+"\n"+f(e,n)):r}}function j(e,t){var r;return t.cache&&t.name&&t.storage.templates.get(t.name)?t.storage.templates.get(t.name):(r="function"==typeof e?e:E(e,t),t.cache&&t.name&&t.storage.templates.define(t.name,r),r)}S.l.bind(S),e.compile=E,e.compileScope=g,e.compileScopeIntoFunction=h,e.compileToString=f,e.defaultConfig=S,e.filters=F,e.getConfig=R,e.helpers=y,e.nativeHelpers=w,e.parse=s,e.render=function(e,r,a,i){var o=R(a||{});if(!o.async)return j(e,o)(r,o);if(!i){if("function"==typeof n)return new n((function(t,n){try{t(j(e,o)(r,o))}catch(e){n(e)}}));throw t("Please provide a callback function, this env doesn't support Promises")}try{j(e,o)(r,o,i)}catch(e){return i(e)}},e.templates=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=squirrelly.min.js.map
