!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).Sqrl={})}(this,(function(e){"use strict";function r(e){var t,n,a=new Error(e);return t=a,n=r.prototype,Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n,a}function t(e,t,n){var a=t.slice(0,n).split(/\n/),i=a.length,c=a[i-1].length+1;throw r(e+=" at line "+i+" col "+c+":\n\n  "+t.split(/\n/)[i-1]+"\n  "+Array(c).join(" ")+"^")}r.prototype=Object.create(Error.prototype,{name:{value:"Squirrelly Error",enumerable:!1}});var n=new Function("return this;")().Promise;function a(e,n){var a=new RegExp("([|()]|=>)|'(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r'\\\\])*?'|`(?:\\\\[\\s\\w\"'\\\\`]|[^\\\\`])*?`|\"(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r\"\\\\])*?\"|\\/\\*[^]*?\\*\\/|((\\/)?(-|_)?"+n.tags[1]+")","g"),i=new RegExp("([^]*?)"+n.tags[0]+"(-|_)?\\s*","g"),c=0,o="";function s(){var r,n={f:[]},s=0,u=e[c],f="c",l="r";function p(r){var a=e.slice(c,r),i=a.trim();if("f"===f)"safe"===i?n.raw=!0:n.f.push([i,""]);else if("fp"===f)n.f[n.f.length-1][1]+=i;else if("err"===f){if(i){var o=a.search(/\S/);t("invalid syntax",e,c+o)}}else n[f]=i;c=r+1}for(c+=1,"~"===u||"#"===u||"/"===u?(f="n",l=u):"!"===u||"?"===u?l=u:"*"===u?n.raw=!0:c-=1,a.lastIndex=c;null!==(r=a.exec(e));){var h=r[1],v=r[2],d=r[3],y=r[4],g=r.index;if(h)"("===h?(0===s&&("n"===f?(p(g),f="p"):"f"===f&&(p(g),f="fp")),s++):")"===h?0===--s&&"c"!==f&&(p(g),f="err"):0===s&&"|"===h?(p(g),f="f"):"=>"===h&&(p(g),c+=1,f="res");else if(v)return p(g),c=g+r[0].length,i.lastIndex=c,o=y,d&&"~"===l&&(l="s"),n.t=l,n}return t("unclosed tag",e,e.length),n}return function a(u,f){u.b=[],u.d=[];var l,p=!1,h=[];function v(e,r){if(e){var t=e.replace(/\\/g,"\\\\").replace(/'/g,"\\'");(t=function(e,r,t,n){var a,i;return"string"==typeof r.autoTrim?a=i=r.autoTrim:Array.isArray(r.autoTrim)&&(a=r.autoTrim[1],i=r.autoTrim[0]),t&&(a=t),n&&(i=n),"slurp"===a&&"slurp"===i||!0===a&&!0===i?e.trim():("_"===a||"slurp"===a||!0===a?e=String.prototype.trimLeft?e.trimLeft():e.replace(/^[\s\uFEFF\xA0]+/,""):"-"!==a&&"nl"!==a||(e=e.replace(/^(?:\n|\r|\r\n)/,"")),"_"===i||"slurp"===i||!0===i?e=String.prototype.trimRight?e.trimRight():e.replace(/[\s\uFEFF\xA0]+$/,""):"-"!==i&&"nl"!==i||(e=e.replace(/(?:\n|\r|\r\n)$/,"")),e)}(t,n,o,r))&&h.push(t)}}for(;null!==(l=i.exec(e));){v(l[1],l[2]),c=l.index+l[0].length;var d=s(),y=d.t;if("~"===y)d=a(d),h.push(d);else if("/"===y){if(u.n===d.n)return p?(p.d=h,u.b.push(p)):u.d=h,u;t("Helper start and end don't match",e,l.index+l[0].length)}else"#"===y?(p?(p.d=h,u.b.push(p)):u.d=h,p=d,h=[]):h.push(d)}if(!f)throw r('unclosed helper "'+u.n+'"');return(v(e.slice(c,e.length)),u.d=h,u)}({f:[]},!0).d}var i=function(){function e(e){this.cache=e}return e.prototype.define=function(e,r){this.cache[e]=r},e.prototype.get=function(e){return this.cache[e]},e.prototype.remove=function(e){delete this.cache[e]},e.prototype.reset=function(){this.cache={}},e.prototype.load=function(e){for(var r in e)e.hasOwnProperty(r)&&(this.cache[r]=e[r])},e}(),c=new i({});function o(e,t,n,a){if(t&&t.length>0)throw r((a?"Native":"")+"Helper '"+e+"' doesn't accept blocks");if(n&&n.length>0)throw r((a?"Native":"")+"Helper '"+e+"' doesn't accept filters")}var s=new i({each:function(e){for(var r="",t=e.params[0],n=0;n<t.length;n++)r+=e.exec(t[n],n);return r},foreach:function(e){var r="",t=e.params[0];for(var n in t)t.hasOwnProperty(n)&&(r+=e.exec(n,t[n]));return r},include:function(e,t,n){o("include",t,!1);var a=c.get(e.params[0]);if(!a)throw r('Could not fetch template "'+e.params[0]+'"');return a(e.params[1],n)},extends:function(e,t,n){var a=e.params[1]||{};a.content=e.exec();for(var i=0;i<t.length;i++){var o=t[i];a[o.name]=o.exec()}var s=c.get(e.params[0]);if(!s)throw r('Could not fetch template "'+e.params[0]+'"');return s(a,n)},useScope:function(e,r){return o("useScope",r,!1),e.exec(e.params[0])}}),u=new i({if:function(e,r){o("if",!1,e.f,!0);var t="if("+e.p+"){"+g(e.d,r)+"}";if(e.b)for(var n=0;n<e.b.length;n++){var a=e.b[n];"else"===a.n?t+="else{"+g(a.d,r)+"}":"elif"===a.n&&(t+="else if("+a.p+"){"+g(a.d,r)+"}")}return t},try:function(e,t){if(o("try",!1,e.f,!0),!e.b||1!==e.b.length||"catch"!==e.b[0].n)throw r("native helper 'try' only accepts 1 block, 'catch'");var n="try{"+g(e.d,t)+"}",a=e.b[0];return n+="catch"+(a.res?"("+a.res+")":"")+"{"+g(a.d,t)+"}"},block:function(e,r){return o("block",e.b,e.f,!0),"if(!"+r.varName+"["+e.p+"]){tR+=("+y(e.d,"",r)+")()}else{tR+="+r.varName+"["+e.p+"]}"}}),f={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#39;"};function l(e){return f[e]}var p=new i({e:function(e){var r=String(e);return/[&<"']/.test(r)?r.replace(/[&<"']/g,l):r}});function h(e,r){var t=a(e,r);return"var tR='';"+(r.useWith?"with("+r.varName+"||{}){":"")+g(t,r).replace(/\n/g,"\\n").replace(/\r/g,"\\r")+"if(cb){return cb(null,tR)} return tR"+(r.useWith?"}":"")}function v(e,r,t,n,a){var i="{exec:"+(e.async?"async ":"")+y(t,r,e)+",params:["+n+"]";return a&&(i+=",name:'"+a+"'"),i+="}"}function d(e,r){for(var t="[",n=0;n<e.length;n++){var a=e[n];t+=v(r,a.res||"",a.d,a.p||"",a.n),n<e.length&&(t+=",")}return t+="]"}function y(e,r,t){return"function("+r+"){var tR='';"+g(e,t)+"return tR}"}function g(e,r){for(var t=0,n=e.length,a="";t<n;t++){var i=e[t];if("string"==typeof i){a+="tR+='"+i+"';"}else{var c=i.t,o=i.c||"",s=i.f,f=i.n||"",l=i.p||"",p=i.res||"",h=i.b;if("r"===c)!i.raw&&r.autoEscape&&(o="c.l('F','e')("+o+")"),a+="tR+="+m(o,s,r)+";";else if("~"===c)if(u.get(f))a+=u.get(f)(i,r);else{var y=(r.async&&r.asyncHelpers&&r.asyncHelpers.includes(f)?"await ":"")+"c.l('H','"+f+"')("+v(r,p,i.d,l);y+=h?","+d(h,r):",[]",a+="tR+="+m(y+=",c)",s,r)+";"}else"s"===c?a+="tR+="+m((r.async&&r.asyncHelpers&&r.asyncHelpers.includes(f)?"await ":"")+"c.l('H','"+f+"')({params:["+l+"]},[],c)",s,r)+";":"!"===c&&(a+=o+";")}}return a}function m(e,r,t){for(var n=0;n<r.length;n++){var a=r[n][0],i=r[n][1];t.async&&t.asyncFilters&&t.asyncFilters.includes(a)&&(e="await "+e),e="c.l('F','"+a+"')("+e,i&&(e+=","+i),e+=")"}return e}var w={varName:"it",autoTrim:[!1,"nl"],autoEscape:!0,defaultFilter:!1,tags:["{{","}}"],l:function(e,t){if("H"===e){var n=s.get(t);if(n)return n;throw r("Can't find helper '"+t+"'")}if("F"===e){var a=p.get(t);if(a)return a;throw r("Can't find filter '"+t+"'")}},async:!1,asyncHelpers:["include","includeFile"],cache:!1,plugins:{processAST:[],processFnString:[]},useWith:!1};function b(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}function x(e,r){var t={};return b(t,w),r&&b(t,r),e&&b(t,e),t}function F(e,t){var n,a=x(t||{});if(a.async)try{n=new Function("return (async function(){}).constructor;")()}catch(e){throw e instanceof SyntaxError?new Error("This environment does not support async/await"):e}else n=Function;try{return new n(a.varName,"c","cb",h(e,a))}catch(t){throw t instanceof SyntaxError?r("Bad template syntax\n\n"+t.message+"\n"+Array(t.message.length+1).join("=")+"\n"+h(e,a)):t}}function R(e,r){var t;return r.cache&&r.name&&c.get(r.name)?c.get(r.name):(t="function"==typeof e?e:F(e,r),r.cache&&r.name&&c.define(r.name,t),t)}e.compile=F,e.compileScope=g,e.compileScopeIntoFunction=y,e.compileToString=h,e.defaultConfig=w,e.filters=p,e.getConfig=x,e.helpers=s,e.nativeHelpers=u,e.parse=a,e.render=function(e,t,a,i){var c=x(a||{});if(!c.async)return R(e,c)(t,c);if(!i){if("function"==typeof n)return new n((function(r,n){try{r(R(e,c)(t,c))}catch(e){n(e)}}));throw r("Please provide a callback function, this env doesn't support Promises")}try{R(e,c)(t,c,i)}catch(e){return i(e)}},e.templates=c,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=squirrelly.min.js.map
