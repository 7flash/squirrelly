!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Sqrl={})}(this,(function(e){"use strict";function t(e){var r,n,a=new Error(e);return r=a,n=t.prototype,Object.setPrototypeOf?Object.setPrototypeOf(r,n):r.__proto__=n,a}function r(e,r,n){var a=r.slice(0,n).split(/\n/),i=a.length,o=a[i-1].length+1;throw t(e+=" at line "+i+" col "+o+":\n\n  "+r.split(/\n/)[i-1]+"\n  "+Array(o).join(" ")+"^")}t.prototype=Object.create(Error.prototype,{name:{value:"Squirrelly Error",enumerable:!1}});var n=new Function("return this;")().Promise;function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function i(e,t,r){for(var n in t)a(t,n)&&(null==t[n]||"object"!=typeof t[n]||"storage"!==n&&"plugins"!==n||r?e[n]=t[n]:e[n]=i({},t[n]));return e}function o(e,n){var a=new RegExp("([|()]|=>)|'(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r'\\\\])*?'|`(?:\\\\[\\s\\w\"'\\\\`]|[^\\\\`])*?`|\"(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r\"\\\\])*?\"|\\/\\*[^]*?\\*\\/|((\\/)?(-|_)?"+n.tags[1]+")","g"),i=new RegExp("([^]*?)"+n.tags[0]+"(-|_)?\\s*","g"),o=0,c="";function s(){var t,n={f:[]},s=0,l=e[o],u="c",f="r";function p(t){var a=e.slice(o,t),i=a.trim();if("f"===u)"safe"===i?n.raw=!0:n.f.push([i,""]);else if("fp"===u)n.f[n.f.length-1][1]+=i;else if("err"===u){if(i){var c=a.search(/\S/);r("invalid syntax",e,o+c)}}else n[u]=i;o=t+1}for(o+=1,"~"===l||"#"===l||"/"===l?(u="n",f=l):"!"===l||"?"===l?f=l:"*"===l?n.raw=!0:o-=1,a.lastIndex=o;null!==(t=a.exec(e));){var h=t[1],g=t[2],v=t[3],d=t[4],m=t.index;if(h)"("===h?(0===s&&("n"===u?(p(m),u="p"):"f"===u&&(p(m),u="fp")),s++):")"===h?0===--s&&"c"!==u&&(p(m),u="err"):0===s&&"|"===h?(p(m),u="f"):"=>"===h&&(p(m),o+=1,u="res");else if(g)return p(m),o=m+t[0].length,i.lastIndex=o,c=d,v&&"~"===f&&(f="s"),n.t=f,n}return r("unclosed tag",e,e.length),n}return function a(l,u){l.b=[],l.d=[];var f,p=!1,h=[];function g(e,t){if(e){var r=e.replace(/\\/g,"\\\\").replace(/'/g,"\\'");(r=function(e,t,r,n){var a,i;return"string"==typeof t.autoTrim?a=i=t.autoTrim:Array.isArray(t.autoTrim)&&(a=t.autoTrim[1],i=t.autoTrim[0]),r&&(a=r),n&&(i=n),"slurp"===a&&"slurp"===i||!0===a&&!0===i?e.trim():("_"===a||"slurp"===a||!0===a?e=String.prototype.trimLeft?e.trimLeft():e.replace(/^[\s\uFEFF\xA0]+/,""):"-"!==a&&"nl"!==a||(e=e.replace(/^(?:\n|\r|\r\n)/,"")),"_"===i||"slurp"===i||!0===i?e=String.prototype.trimRight?e.trimRight():e.replace(/[\s\uFEFF\xA0]+$/,""):"-"!==i&&"nl"!==i||(e=e.replace(/(?:\n|\r|\r\n)$/,"")),e)}(r,n,c,t))&&h.push(r)}}for(;null!==(f=i.exec(e));){g(f[1],f[2]),o=f.index+f[0].length;var v=s(),d=v.t;if("~"===d)v=a(v),h.push(v);else if("/"===d){if(l.n===v.n)return p?(p.d=h,l.b.push(p)):l.d=h,l;r("Helper start and end don't match",e,f.index+f[0].length)}else"#"===d?(p?(p.d=h,l.b.push(p)):l.d=h,p=v,h=[]):h.push(v)}if(!u)throw t('unclosed helper "'+l.n+'"');return g(e.slice(o,e.length)),l.d=h,l}({f:[]},!0).d}function c(e,t){var r=o(e,t);return"var tR='';"+(t.useWith?"with("+t.varName+"||{}){":"")+p(r,t).replace(/\n/g,"\\n").replace(/\r/g,"\\r")+"if(cb){return cb(null,tR)} return tR"+(t.useWith?"}":"")}function s(e,t,r){for(var n=0;n<t.length;n++){var a=t[n][0],i=t[n][1];r.async&&r.asyncFilters&&r.asyncFilters.includes(a)&&(e="await "+e),e="c.l('F','"+a+"')("+e,i&&(e+=","+i),e+=")"}return e}function l(e,t,r,n,a){var i="{exec:"+(e.async?"async ":"")+f(r,t,e)+",params:["+n+"]";return a&&(i+=",name:'"+a+"'"),i+="}"}function u(e,t){for(var r="[",n=0;n<e.length;n++){var a=e[n];r+=l(t,a.res||"",a.d,a.p||"",a.n),n<e.length&&(r+=",")}return r+="]"}function f(e,t,r){return"function("+t+"){var tR='';"+p(e,r)+"return tR}"}function p(e,t){for(var r=0,n=e.length,a="";r<n;r++){var i=e[r];if("string"==typeof i){a+="tR+='"+i+"';"}else{var o=i.t,c=i.c||"",f=i.f,p=i.n||"",h=i.p||"",g=i.res||"",v=i.b;if("r"===o)!i.raw&&t.autoEscape&&(c="c.l('F','e')("+c+")"),a+="tR+="+s(c,f,t)+";";else if("~"===o)if(t.storage.nativeHelpers.get(p))a+=t.storage.nativeHelpers.get(p)(i,t);else{var d=(t.async?"await ":"")+"c.l('H','"+p+"')("+l(t,g,i.d,h);d+=v?","+u(v,t):",[]",a+="tR+="+s(d+=",c)",f,t)+";"}else"s"===o?a+="tR+="+s((t.async&&t.asyncHelpers&&t.asyncHelpers.includes(p)?"await ":"")+"c.l('H','"+p+"')({params:["+h+"]},[],c)",f,t)+";":"!"===o&&(a+=c)}}return a}var h=function(){function e(e){this.cache=e}return e.prototype.define=function(e,t){this.cache[e]=t},e.prototype.get=function(e){return this.cache[e]},e.prototype.remove=function(e){delete this.cache[e]},e.prototype.reset=function(){this.cache={}},e.prototype.load=function(e){i(this.cache,e,!0)},e}(),g=new h({});function v(e,r,n,a){if(r&&r.length>0)throw t((a?"Native":"")+"Helper '"+e+"' doesn't accept blocks");if(n&&n.length>0)throw t((a?"Native":"")+"Helper '"+e+"' doesn't accept filters")}var d=new h({each:function(e){for(var t="",r=e.params[0],n=0;n<r.length;n++)t+=e.exec(r[n],n);return t},foreach:function(e){var t="",r=e.params[0];for(var n in r)a(r,n)&&(t+=e.exec(n,r[n]));return t},include:function(e,r,n){v("include",r,!1);var a=n.storage.templates.get(e.params[0]);if(!a)throw t('Could not fetch template "'+e.params[0]+'"');return a(e.params[1],n)},extends:function(e,r,n){var a=e.params[1]||{};a.content=e.exec();for(var i=0;i<r.length;i++){var o=r[i];a[o.name]=o.exec()}var c=n.storage.templates.get(e.params[0]);if(!c)throw t('Could not fetch template "'+e.params[0]+'"');return c(a,n)},useScope:function(e,t){return v("useScope",t,!1),e.exec(e.params[0])}}),m=new h({if:function(e,t){v("if",!1,e.f,!0);var r="if("+e.p+"){"+p(e.d,t)+"}";if(e.b)for(var n=0;n<e.b.length;n++){var a=e.b[n];"else"===a.n?r+="else{"+p(a.d,t)+"}":"elif"===a.n&&(r+="else if("+a.p+"){"+p(a.d,t)+"}")}return r},try:function(e,r){if(v("try",!1,e.f,!0),!e.b||1!==e.b.length||"catch"!==e.b[0].n)throw t("native helper 'try' only accepts 1 block, 'catch'");var n="try{"+p(e.d,r)+"}",a=e.b[0];return n+="catch"+(a.res?"("+a.res+")":"")+"{"+p(a.d,r)+"}"},block:function(e,t){return v("block",e.b,e.f,!0),"if(!"+t.varName+"["+e.p+"]){tR+=("+f(e.d,"",t)+")()}else{tR+="+t.varName+"["+e.p+"]}"}}),y={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#39;"};function w(e){return y[e]}var b=new h({e:function(e){var t=String(e);return/[&<"']/.test(t)?t.replace(/[&<"']/g,w):t}}),x={varName:"it",autoTrim:[!1,"nl"],autoEscape:!0,defaultFilter:!1,tags:["{{","}}"],l:function(e,r){if("H"===e){var n=this.storage.helpers.get(r);if(n)return n;throw t("Can't find helper '"+r+"'")}if("F"===e){var a=this.storage.filters.get(r);if(a)return a;throw t("Can't find filter '"+r+"'")}},async:!1,storage:{helpers:d,nativeHelpers:m,filters:b,templates:g},asyncHelpers:["include","includeFile"],cache:!1,plugins:{processAST:[],processFnString:[]},useWith:!1};function F(e,t){var r={};return i(r,x),t&&i(r,t),e&&i(r,e),r.l.bind(r),r}function R(e,r){var n,a=F(r||{});if(a.async)try{n=new Function("return (async function(){}).constructor;")()}catch(e){throw e instanceof SyntaxError?new Error("This environment doesn't support async/await"):e}else n=Function;try{return new n(a.varName,"c","cb",c(e,a))}catch(r){throw r instanceof SyntaxError?t("Bad template syntax\n\n"+r.message+"\n"+Array(r.message.length+1).join("=")+"\n"+c(e,a)):r}}function S(e,t){var r;return t.cache&&t.name&&t.storage.templates.get(t.name)?t.storage.templates.get(t.name):(r="function"==typeof e?e:R(e,t),t.cache&&t.name&&t.storage.templates.define(t.name,r),r)}x.l.bind(x),e.compile=R,e.compileScope=p,e.compileScopeIntoFunction=f,e.compileToString=c,e.defaultConfig=x,e.filters=b,e.getConfig=F,e.helpers=d,e.nativeHelpers=m,e.parse=o,e.render=function(e,r,a,i){var o=F(a||{});if(!o.async)return S(e,o)(r,o);if(!i){if("function"==typeof n)return new n((function(t,n){try{t(S(e,o)(r,o))}catch(e){n(e)}}));throw t("Please provide a callback function, this env doesn't support Promises")}try{S(e,o)(r,o,i)}catch(e){return i(e)}},e.templates=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=squirrelly.min.js.map
