!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Sqrl={})}(this,(function(e){"use strict";function t(e){var r,n,i=new Error(e);return r=i,n=t.prototype,Object.setPrototypeOf?Object.setPrototypeOf(r,n):r.__proto__=n,i}function r(e,r,n){var i=r.slice(0,n).split(/\n/),a=i.length,c=i[a-1].length+1;throw t(e+=" at line "+a+" col "+c+":\n\n  "+r.split(/\n/)[a-1]+"\n  "+Array(c).join(" ")+"^")}function n(e,t,n,i){var a=new RegExp("([|()]|=>)|'(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r'\\\\])*?'|`(?:\\\\[\\s\\w\"'\\\\`]|[^\\\\`])*?`|\"(?:\\\\[\\s\\w\"'\\\\`]|[^\\n\\r\"\\\\])*?\"|\\/\\*[^]*?\\*\\/|((\\/)?(-|_)?"+n+")","g"),c=new RegExp("([^]*?)"+t+"(-|_)?\\s*","g"),o=0,f="";function u(){var t,n={f:[]},i=0,u=e[o],l="c",s="r";function p(t,i){var a=e.slice(o,t)+(i||""),c=a.trim();if("f"===l)"safe"===c?n.raw=!0:n.f.push([c,""]);else if("fp"===l)n.f[n.f.length-1][1]+=c;else if("err"===l){if(c){var f=a.search(/\S/);r("invalid syntax",e,o+f)}}else l&&(n[l]=c);o=t+1}for(o+=1,"~"===u||"#"===u||"/"===u?(l="n",s=u):"!"===u||"?"===u?s=u:"*"===u?n.raw=!0:o-=1,a.lastIndex=o;null!==(t=a.exec(e));){var h=t[1],v=t[2],d=t[3],g=t[4],y=t.index;if(h)"("===h?(0===i&&("n"===l?(p(y),l="p"):"f"===l&&(p(y),l="fp")),i++):")"===h?0===--i&&"c"!==l&&(p(y),l="err"):0===i&&"|"===h?(p(y),l="f"):"=>"===h&&(p(y),o+=1,l="res");else if(v)return p(y),o+=v.length-1,c.lastIndex=o,f=g,d&&"~"===s&&(s="s"),n.t=s,n}return r("unclosed tag",e,e.length),n}return function t(n,i){n.b=[],n.d=[];var a,l=!1,s=[];function p(e,t){if(e){var r=e.replace(/\\/g,"\\\\").replace(/'/g,"\\'");t&&(r=function(e,t){return"_"===t?String.prototype.trimRight?e.trimRight():e.replace(/[\s\uFEFF\xA0]+$/,""):e.replace(/(?:[\s\uFEFF\xA0]|\r\n)$/,"")}(r,t)),f&&(r=function(e,t){return"_"===t?String.prototype.trimLeft?e.trimLeft():e.replace(/^[\s\uFEFF\xA0]+/,""):e.replace(/^(?:[\s\uFEFF\xA0]|\r\n)/,"")}(r,f),f=""),s.push(r)}}for(;null!==(a=c.exec(e));){p(a[1],a[2]),o=a.index+a[0].length;var h=u(),v=h.t;if("~"===v)h=t(h),s.push(h);else if("/"===v){if(n.n===h.n)return l?(l.d=s,n.b.push(l)):n.d=s,n;r("Helper start and end don't match",e,a.index+a[0].length)}else"#"===v?(l?(l.d=s,n.b.push(l)):n.d=s,l=h,s=[]):s.push(h)}return i&&(p(e.slice(o,e.length)),n.d=s),n}({f:[]},!0).d}t.prototype=Object.create(Error.prototype,{name:{value:"Squirrelly Error",enumerable:!1}});var i=function(){function e(e){this.cache=e}return e.prototype.define=function(e,t){this.cache[e]=t},e.prototype.get=function(e){return this.cache[e]},e.prototype.remove=function(e){delete this.cache[e]},e.prototype.clear=function(){this.cache={}},e.prototype.load=function(e){this.cache=e},e}(),a=new i({}),c=new i({}),o=new i({each:function(e){for(var t="",r=e.params[0],n=0;n<r.length;n++)t+=e.exec(r[n],n);return t},foreach:function(e){var t="",r=e.params[0];for(var n in r)r.hasOwnProperty(n)&&(t+=e.exec(r,n));return t}}),f=new i({if:function(e,r){if(e.f&&e.f.length)throw t("native helper 'if' can't have filters");var n="if("+e.p+"){"+g(e.d,r)+"}";if(e.b)for(var i=0;i<e.b.length;i++){var a=e.b[i];"else"===a.n?n+="else{"+g(a.d,r)+"}":"elif"===a.n&&(n+="else if("+a.p+"){"+g(a.d,r)+"}")}return n},try:function(e,r){if(e.f&&e.f.length)throw t("native helper 'try' can't have filters");if(!e.b||1!==e.b.length||"catch"!==e.b[0].n)throw t("native helper 'try' only accepts 1 block, 'catch'");var n="try{"+g(e.d,r)+"}",i=e.b[0];return n+="catch"+(i.res?"("+i.res+")":"")+"{"+g(i.d,r)+"}"}}),u={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#39;"};function l(e){return u[e]}var s=new i({e:function(e){var t=String(e);return/[&<"']/.test(t)?t.replace(/[&<"']/g,l):t}});function p(e,t,r,i){return"var tR='';"+g(n(e,t,r),i).replace(/\n/g,"\\n").replace(/\r/g,"\\r")+"return tR"}function h(e,t,r,n,i){var a="{exec:"+d(r,t,e)+",params:["+n+"]";return i&&(a+=",name:'"+i+"'"),a+="}"}function v(e,t){for(var r="[",n=0;n<e.length;n++){var i=e[n];r+=h(t,i.res||"",i.d,i.p||"",i.n),n<e.length&&(r+=",")}return r+="]"}function d(e,t,r){return"function("+t+"){var tR='';"+g(e,r)+"return tR}"}function g(e,t){for(var r=0,n=e.length,i="";r<n;r++){var a=e[r];if("string"==typeof a){i+="tR+='"+a+"';"}else{var c=a.t,o=a.c||"",u=a.f,l=a.n||"",s=a.p||"",p=a.res||"",d=a.b;if("r"===c)!a.raw&&t.autoEscape&&(o='Sqrl.F.get("e")('+o+")"),i+="tR+="+y(o,u)+";";else if("~"===c)if(f.get(l))i+=f.get(l)(a,t);else{var g="Sqrl.H.get('"+l+"')("+h(t,p,a.d,s);d&&(g+=","+v(d,t)),i+="tR+="+y(g+=")",u)+";"}else"s"===c?i+="tR+="+y("Sqrl.H.get('"+l+"')("+s+")",u)+";":"!"===c&&(i+=o+";")}}return i}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r][0],i=t[r][1];e="Sqrl.F.get('"+n+"')("+e,i&&(e+=","+i),e+=")"}return e}var m={varName:"it",autoTrim:!1,autoEscape:!0,defaultFilter:!1},w={cache:{default:m},define:function(e,t){for(var r in this.cache[e]||(this.cache[e]=m),t)this.cache[e][r]=t[r]},get:function(e){return this.cache[e]},remove:function(e){delete this.cache[e]},clear:function(){this.cache={}},load:function(e){this.cache=e}};function x(e,t,r,n){var i=w.get(n||"default");return new Function(i.varName,"Sqrl",p(e,t,r,i))}e.Compile=x,e.CompileToString=p,e.Env=w,e.Filters=s,e.Helpers=o,e.Layouts=a,e.NativeHelpers=f,e.Parse=n,e.ParseScope=g,e.ParseScopeIntoFunction=d,e.Partials=c,e.Render=function(e,t,r,n){return r?"function"==typeof r&&(r=r(n)):r="default","function"==typeof e?e(t,{H:o,F:s}):x(e,"{{","}}",r)(t,{H:o,F:s})},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=squirrelly.min.js.map
